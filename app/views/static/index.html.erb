<body id="home">
<div class="container-fluid">
  <h1 id="merry-christmas">merry christmas<span class="small"> and a happy new year</span></h1 id="merry-christmas">

  <div class="row">
    <div class="col-md-7">
      <div id="home-photo">
        <%= image_tag "family.jpg" %>
        <p>we should also have a good family photo</p>
      </div>
      <div class="col-sm-12" id="words">
        <div class="col-sm-10" >
          <p>happy holidays, friends!  we're so glad that you're a part of our lives and are glad you stopped by to see what's been going on in ours.</p>
          <p>words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words words </p>
        </div>
        <div class="col-sm-2" id="calendar-button">
          <%= link_to by_the_month_path do %>
            here's what went down <i class="fa fa-arrow-right"></i>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-md-5">
      <div id="snow-globe">
        <%= image_tag "1208_jefferson.jpg", :id => "house" %>
        <%= image_tag "https://media.giphy.com/media/4M6xlFxZskH8A/giphy.gif", :id => "snow" %>
        <div id="address">
          <h3>We've moved!</h3>
          <p>1208 Jefferson Ave. <br> Louisville, CO 80027</p>
        </div>
      </div>
      <div class="game">
      </div>
    </div>
  </div>
</div>
</body>
<script type="text/javascript">

    var CANVAS_WIDTH = 480;
    var CANVAS_HEIGHT = 320;

    var canvasElement = $("<canvas id='myCanvas' width='" + CANVAS_WIDTH +
                          "' height='" + CANVAS_HEIGHT + "'></canvas>");
    var canvas = canvasElement.get(0).getContext("2d");
    canvasElement.appendTo('.game');

    var FPS = 30;
    setInterval(function() {
      update();
      draw();
    }, 1000/FPS);

    var textX = 50;
    var textY = 50;

    function update() {
      if (keydown.left) {
        player.x -= 5;
      }

      if (keydown.right) {
        player.x += 5;
      }

      player.x = player.x.clamp(0, CANVAS_WIDTH - player.width);

      enemies.forEach(function(enemy) {
        enemy.update();
      });

      enemies = enemies.filter(function(enemy) {
        return enemy.active;
      });

      if(Math.random() < 0.1) {
        enemies.push(Enemy());
      }

      handleCollisions();
    }

    function draw() {
      canvas.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
      if (keydown.left) {
        player.drawLeft();
      }
      else if (keydown.right) {
        player.drawRight();
      } else {
        player.drawLips();
      }
      enemies.forEach(function(enemy) {
        enemy.draw();
      });
    }

    var player = {
      color: "#000",
      x: 220,
      y: 270,
      width: 32,
      height: 32,
      drawLeft: function() {
        this.sprite1.draw(canvas, this.x, this.y);
        // canvas.fillStyle = this.color;
        // canvas.fillRect(this.x, this.y, this.width, this.height);
      },
      drawRight: function() {
        this.sprite2.draw(canvas, this.x, this.y);
      },
      drawLips: function() {
        this.sprite3.draw(canvas, this.x, this.y);
      }
    }

    enemies = [];

    function Enemy(I) {
      I = I || {};

      I.active = true;
      I.age = Math.floor(Math.random() * 128);

      I.color = "#A2B";

      I.x = CANVAS_WIDTH / 4 + Math.random() * CANVAS_WIDTH / 2;
      I.y = 0;
      I.xVelocity = 0
      I.yVelocity = 2;

      I.width = 32;
      I.height = 32;

      I.inBounds = function() {
        return I.x >= 0 && I.x <= CANVAS_WIDTH &&
          I.y >= 0 && I.y <= CANVAS_HEIGHT;
      };

      I.sprite = Sprite("snowflake");

      I.draw = function() {
        this.sprite.draw(canvas, this.x, this.y);
        // canvas.fillStyle = this.color;
        // canvas.fillRect(this.x, this.y, this.width, this.height);
      };

      I.update = function() {
        I.x += I.xVelocity;
        I.y += I.yVelocity;

        I.xVelocity = 3 * Math.sin(I.age * Math.PI / 64);

        I.age++;

        I.active = I.active && I.inBounds();
      };

      I.explode = function() {
        this.active = false;
      };

      return I;
    };

    function collides(a, b) {
      return a.x < b.x + b.width &&
         a.x + a.width > b.x &&
         a.y < b.y + b.height &&
         a.y + a.height > b.y;
    }

    function handleCollisions() {
      // playerBullets.forEach(function(bullet) {
      //   enemies.forEach(function(enemy) {
      //     if (collides(bullet, enemy)) {
      //       enemy.explode();
      //       bullet.active = false;
      //     }
      //   });
      // });

      enemies.forEach(function(enemy) {
        if (collides(enemy, player)) {
          enemy.explode();
          player.explode();
        }
      });
    }

    player.explode = function() {
      console.log("1");
    };

    player.sprite1 = Sprite("tongue1");
    player.sprite2 = Sprite("tongue2");
    player.sprite3 = Sprite("lips9");
</script>
